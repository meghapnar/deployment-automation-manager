pipeline {
    agent any
    stages {
    stage('Checkout Branch to Deploy') {
      steps{
        bat '''
        rmdir /s /q %git_repo_name%
        git clone "%git_repo_url%"
        git checkout "%git_branch_name%"
        git pull
        cd %git_repo_name%
        set application_path="%cd%"
        echo %application_path%
        '''
      }
    }
      stage('Importing Application') {
        steps {
            bat '''
              echo '%application_path%'
              cd appian-adm-import-client-2.5.9
              cd
              IF "%ddl_path%"=="" goto :deployOnlyApp
              ELSE  goto :deployAll
              :deployOnlyApp
              IF "%proxy_url%"=="" deploy-application.bat -username "%appian_username%" -password "%appian_pwd%" -url "%target_environment%" -application_path "%application_path%" -admin_console_path "%admin_console_path%" -force_import "%force_import%" -import_customization_path "%import_customization_path%" -inspect_only "%inspect_only%" -uuid "%uuid%"
              ELSE deploy-application.bat -username "%appian_username%" -password "%appian_pwd%" -url "%target_environment%" -application_path "%application_path%" -admin_console_path "%admin_console_path%" -force_import "%force_import%" -import_customization_path "%import_customization_path%" -inspect_only "%inspect_only%" -proxy_port %proxy_port% -proxy_url "%proxy_url%" -uuid "%uuid%"
              :deployAll
              IF "%proxy_url%"=="" deploy-application.bat -username "%appian_username%" -password "%appian_pwd%" -url "%target_environment%" -application_path "%application_path%" -admin_console_path "%admin_console_path%" -ac_customization_path "%ac_customization_path%" -ddl_ds "%ddl_ds%" -ddl_path "%ddl_path%" -flyway_path "%flyway_path%" -force_import "%force_import%" -import_customization_path "%import_customization_path%" -inspect_only "%inspect_only%" -uuid "%uuid%"
              ELSE deploy-application.bat -username "%appian_username%" -password "%appian_pwd%" -url "%target_environment%" -application_path "%application_path%" -admin_console_path "%admin_console_path%" -ac_customization_path "%ac_customization_path%" -ddl_ds "%ddl_ds%" -ddl_path "%ddl_path%" -flyway_path "%flyway_path%" -force_import "%force_import%" -import_customization_path "%import_customization_path%" -inspect_only "%inspect_only%" -proxy_port "%proxy_port%" -proxy_url "%proxy_url%" -uuid "%uuid%"
              '''
              }
          }
      }
}
